# é€šçŸ¥ç³»ç»Ÿç›‘æ§APIæ–‡æ¡£

## ğŸ“Š æ–°å¢ç›‘æ§åŠŸèƒ½æ¦‚è§ˆ

æœ¬æ¬¡æ›´æ–°ä¸ºæ ¡å›­äº¤æ˜“ç³»ç»Ÿçš„é€šçŸ¥æ¨¡å—æ·»åŠ äº†å®Œæ•´çš„é‚®ä»¶å’ŒSignalRç›‘æ§åŠŸèƒ½ï¼Œæä¾›ä¼ä¸šçº§çš„ç›‘æ§èƒ½åŠ›ã€‚

## ğŸ”” æ–°å¢APIæ¥å£

### 1. é‚®ä»¶å‘é€ç»Ÿè®¡ç›‘æ§
**æ¥å£:** `GET /api/notification/email-stats`
**åŠŸèƒ½:** è·å–é‚®ä»¶å‘é€æˆåŠŸç‡å’Œè¯¦ç»†ç»Ÿè®¡
**å‚æ•°:**
- `startTime` (å¯é€‰): å¼€å§‹æ—¶é—´ (æ ¼å¼: yyyy-MM-dd HH:mm:ss)
- `endTime` (å¯é€‰): ç»“æŸæ—¶é—´ (æ ¼å¼: yyyy-MM-dd HH:mm:ss)

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "successRate": 92.5,
    "totalSent": 1250,
    "successful": 1156,
    "failed": 94,
    "pending": 15,
    "period": {
      "startTime": "2025-08-09 00:00:00",
      "endTime": "2025-08-10 23:59:59"
    }
  },
  "message": "é‚®ä»¶å‘é€æˆåŠŸç‡: 92.50%"
}
```

### 2. SignalRå‘é€ç»Ÿè®¡ç›‘æ§
**æ¥å£:** `GET /api/notification/signalr-stats`
**åŠŸèƒ½:** è·å–SignalRå‘é€æˆåŠŸç‡å’Œè¯¦ç»†ç»Ÿè®¡
**å‚æ•°:** åŒé‚®ä»¶ç»Ÿè®¡æ¥å£

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "successRate": 96.8,
    "totalSent": 1580,
    "successful": 1529,
    "failed": 51,
    "pending": 8,
    "period": {
      "startTime": null,
      "endTime": null
    }
  },
  "message": "SignalRå‘é€æˆåŠŸç‡: 96.80%"
}
```

### 3. é‚®ä»¶å¤±è´¥åŸå› åˆ†æ
**æ¥å£:** `GET /api/notification/email-failure-analysis`
**åŠŸèƒ½:** åˆ†æé‚®ä»¶å‘é€å¤±è´¥çš„å…·ä½“åŸå› å’Œæ—¶é—´è¶‹åŠ¿
**å‚æ•°:**
- `topN` (å¯é€‰): è¿”å›å‰Nä¸ªå¤±è´¥åŸå› ï¼Œé»˜è®¤10ä¸ª

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "failureReasons": {
      "SMTPæœåŠ¡å™¨è¿æ¥è¶…æ—¶": 25,
      "é‚®ç®±åœ°å€æ ¼å¼é”™è¯¯": 18,
      "æ”¶ä»¶äººé‚®ç®±ä¸å­˜åœ¨": 12,
      "é‚®ä»¶å†…å®¹è¢«æ‹’ç»": 8
    },
    "hourlyTrend": {
      "0": { "Success": 45, "Failed": 2 },
      "1": { "Success": 38, "Failed": 1 },
      "8": { "Success": 156, "Failed": 8 },
      "9": { "Success": 198, "Failed": 12 }
    },
    "analysisTime": "2025-08-10T12:00:00Z"
  },
  "message": "è·å–é‚®ä»¶å¤±è´¥åˆ†ææˆåŠŸï¼Œå…±åˆ†æ 4 ç§å¤±è´¥åŸå› "
}
```

### 4. SignalRå¤±è´¥åŸå› åˆ†æ
**æ¥å£:** `GET /api/notification/signalr-failure-analysis`
**åŠŸèƒ½:** åˆ†æSignalRå‘é€å¤±è´¥çš„å…·ä½“åŸå› å’Œæ—¶é—´è¶‹åŠ¿
**å‚æ•°:** åŒé‚®ä»¶å¤±è´¥åˆ†æ

### 5. é€šçŸ¥ç³»ç»Ÿå¥åº·ç›‘æ§
**æ¥å£:** `GET /api/notification/health`
**åŠŸèƒ½:** è·å–é€šçŸ¥ç³»ç»Ÿçš„æ•´ä½“å¥åº·çŠ¶å†µ
**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "overallHealth": 94.5,
    "healthStatus": "è‰¯å¥½",
    "timestamp": "2025-08-10T12:00:00Z",
    "systems": {
      "notification": {
        "successRate": 93.2,
        "pending": 25,
        "failed": 15,
        "status": "å¥åº·"
      },
      "email": {
        "successRate": 92.5,
        "pending": 8,
        "failed": 12,
        "status": "å¥åº·"
      },
      "signalR": {
        "successRate": 96.8,
        "pending": 3,
        "failed": 5,
        "status": "å¥åº·"
      }
    }
  },
  "message": "é€šçŸ¥ç³»ç»Ÿæ•´ä½“çŠ¶å†µ: è‰¯å¥½"
}
```

### 6. ç»¼åˆç›‘æ§é¢æ¿
**æ¥å£:** `GET /api/notification/monitoring-dashboard`
**åŠŸèƒ½:** æä¾›å®Œæ•´çš„ç›‘æ§é¢æ¿æ•°æ®ï¼ŒåŒ…å«ç³»ç»Ÿæ¦‚è§ˆã€æˆåŠŸç‡ç»Ÿè®¡ã€é˜Ÿåˆ—çŠ¶æ€ã€å¤±è´¥åˆ†æã€è¶‹åŠ¿æ•°æ®å’Œç³»ç»Ÿå»ºè®®

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "systemOverview": {
      "overallHealth": 94.5,
      "healthStatus": "è‰¯å¥½",
      "timestamp": "2025-08-10T12:00:00Z",
      "totalNotifications": 2850,
      "totalEmails": 1250,
      "totalSignalR": 1580
    },
    "successRates": {
      "notification": 93.2,
      "email": 92.5,
      "signalR": 96.8
    },
    "queueStatus": {
      "notification": {
        "pending": 25,
        "success": 2658,
        "failed": 167,
        "total": 2850,
        "status": "æ­£å¸¸"
      },
      "email": {...},
      "signalR": {...}
    },
    "failureAnalysis": {
      "email": {
        "topFailureReasons": {...},
        "totalFailures": 94
      },
      "signalR": {...}
    },
    "hourlyTrends": {
      "email": {...},
      "signalR": {...}
    },
    "recommendations": [
      "âœ… ç³»ç»Ÿè¿è¡ŒçŠ¶æ€è‰¯å¥½ï¼Œç»§ç»­ä¿æŒå½“å‰é…ç½®"
    ]
  },
  "message": "é€šçŸ¥ç³»ç»Ÿç›‘æ§é¢æ¿è·å–æˆåŠŸï¼Œç³»ç»ŸçŠ¶æ€: è‰¯å¥½"
}
```

## ğŸ¯ ç›‘æ§æŒ‡æ ‡è¯´æ˜

### æˆåŠŸç‡è®¡ç®—
- **é€šçŸ¥æˆåŠŸç‡** = æˆåŠŸå‘é€çš„é€šçŸ¥æ•° / æ€»é€šçŸ¥æ•° Ã— 100%
- **é‚®ä»¶æˆåŠŸç‡** = æˆåŠŸå‘é€çš„é‚®ä»¶æ•° / æ€»é‚®ä»¶æ•° Ã— 100%
- **SignalRæˆåŠŸç‡** = æˆåŠŸå‘é€çš„SignalRæ¶ˆæ¯æ•° / æ€»SignalRæ¶ˆæ¯æ•° Ã— 100%

### å¥åº·çŠ¶æ€è¯„çº§
- **ä¼˜ç§€**: æˆåŠŸç‡ â‰¥ 95%
- **è‰¯å¥½**: æˆåŠŸç‡ â‰¥ 90%
- **ä¸€èˆ¬**: æˆåŠŸç‡ â‰¥ 80%
- **è­¦å‘Š**: æˆåŠŸç‡ â‰¥ 70%
- **ä¸¥é‡**: æˆåŠŸç‡ < 70%

### é˜Ÿåˆ—çŠ¶æ€åˆ¤æ–­
- **æ­£å¸¸**: ç§¯å‹é‡åœ¨æ­£å¸¸èŒƒå›´å†…
- **è­¦å‘Š**: ç§¯å‹é‡è¾ƒé«˜æˆ–å¤±è´¥ç‡åé«˜
- **ç§¯å‹**: é˜Ÿåˆ—ç§¯å‹ä¸¥é‡ï¼Œéœ€è¦å¤„ç†

## ğŸ”§ æ–°å¢æœåŠ¡æ–¹æ³•

### NotifiSenderService æ–°å¢æ–¹æ³•
- `GetEmailStatsAsync()`: è·å–é‚®ä»¶ç»Ÿè®¡
- `GetSignalRStatsAsync()`: è·å–SignalRç»Ÿè®¡
- `GetEmailStatsAsync(startTime, endTime)`: è·å–æ—¶é—´èŒƒå›´å†…é‚®ä»¶ç»Ÿè®¡
- `GetSignalRStatsAsync(startTime, endTime)`: è·å–æ—¶é—´èŒƒå›´å†…SignalRç»Ÿè®¡
- `GetEmailFailureReasonsAsync(topN)`: è·å–é‚®ä»¶å¤±è´¥åŸå› ç»Ÿè®¡
- `GetSignalRFailureReasonsAsync(topN)`: è·å–SignalRå¤±è´¥åŸå› ç»Ÿè®¡
- `GetHourlyEmailTrendAsync(days)`: è·å–é‚®ä»¶æ¯å°æ—¶è¶‹åŠ¿
- `GetHourlySignalRTrendAsync(days)`: è·å–SignalRæ¯å°æ—¶è¶‹åŠ¿

### EmailService æ–°å¢æ–¹æ³•
- `GetEmailStatsAsync(startTime, endTime)`: æ—¶é—´èŒƒå›´é‚®ä»¶ç»Ÿè®¡
- `GetEmailFailureReasonsAsync(topN)`: é‚®ä»¶å¤±è´¥åŸå› åˆ†æ
- `GetHourlyEmailTrendAsync(days)`: é‚®ä»¶å‘é€è¶‹åŠ¿åˆ†æ

### SignalRNotificationService æ–°å¢æ–¹æ³•
- `GetSignalRStatsAsync(startTime, endTime)`: æ—¶é—´èŒƒå›´SignalRç»Ÿè®¡
- `GetSignalRFailureReasonsAsync(topN)`: SignalRå¤±è´¥åŸå› åˆ†æ
- `GetHourlySignalRTrendAsync(days)`: SignalRå‘é€è¶‹åŠ¿åˆ†æ

## ğŸ“± ä½¿ç”¨åœºæ™¯

### 1. è¿ç»´ç›‘æ§
- å®æ—¶ç›‘æ§é€šçŸ¥ç³»ç»Ÿå¥åº·çŠ¶å†µ
- åŠæ—¶å‘ç°å’Œå¤„ç†ç³»ç»Ÿå¼‚å¸¸
- åˆ†æå‘é€å¤±è´¥åŸå› ï¼Œä¼˜åŒ–ç³»ç»Ÿé…ç½®

### 2. æ€§èƒ½åˆ†æ
- åˆ†æé‚®ä»¶å’ŒSignalRçš„å‘é€æˆåŠŸç‡
- ç›‘æ§é˜Ÿåˆ—ç§¯å‹æƒ…å†µ
- æŸ¥çœ‹ä¸åŒæ—¶é—´æ®µçš„å‘é€è¶‹åŠ¿

### 3. æ•…éšœæ’æŸ¥
- å¿«é€Ÿå®šä½å‘é€å¤±è´¥çš„å…·ä½“åŸå› 
- åˆ†æå¤±è´¥æ¨¡å¼ï¼Œåˆ¶å®šè§£å†³æ–¹æ¡ˆ
- ç›‘æ§ä¿®å¤æ•ˆæœ

### 4. ç®¡ç†å†³ç­–
- åŸºäºæ•°æ®åˆ¶å®šç³»ç»Ÿä¼˜åŒ–ç­–ç•¥
- è¯„ä¼°é€šçŸ¥ç³»ç»Ÿçš„æœåŠ¡è´¨é‡
- é¢„æµ‹å’Œé¢„é˜²æ½œåœ¨é—®é¢˜

## ğŸ‰ åŠŸèƒ½äº®ç‚¹

1. **å®Œæ•´çš„æˆåŠŸç‡ç›‘æ§**: æ”¯æŒå®æ—¶å’Œå†å²æˆåŠŸç‡ç»Ÿè®¡
2. **æ·±åº¦å¤±è´¥åˆ†æ**: æä¾›å…·ä½“å¤±è´¥åŸå› å’Œè¶‹åŠ¿åˆ†æ
3. **æ™ºèƒ½å¥åº·è¯„ä¼°**: è‡ªåŠ¨è¯„ä¼°ç³»ç»Ÿå¥åº·çŠ¶å†µå¹¶æä¾›å»ºè®®
4. **çµæ´»çš„æ—¶é—´èŒƒå›´**: æ”¯æŒè‡ªå®šä¹‰æ—¶é—´èŒƒå›´æŸ¥è¯¢
5. **ç»¼åˆç›‘æ§é¢æ¿**: ä¸€ç«™å¼ç›‘æ§è§†å›¾ï¼Œæ–¹ä¾¿è¿ç»´ç®¡ç†
6. **ä¼ä¸šçº§ç›‘æ§**: æä¾›ä¸“ä¸šçš„ç›‘æ§æŒ‡æ ‡å’Œå»ºè®®ç³»ç»Ÿ

è¿™å¥—ç›‘æ§ç³»ç»Ÿä¸ºæ ¡å›­äº¤æ˜“å¹³å°çš„é€šçŸ¥æ¨¡å—æä¾›äº†å…¨é¢çš„å¯è§‚æµ‹æ€§ï¼Œç¡®ä¿é€šçŸ¥æœåŠ¡çš„é«˜å¯ç”¨æ€§å’Œå¯é æ€§ã€‚
